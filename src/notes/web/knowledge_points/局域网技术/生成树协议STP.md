---
order: 3
---

# 生成树协议STP

## 能干什么

解决二层网络出现的物理环路。交换机会产生广播风暴，此时通过STP可以选举出阻塞端口来逻辑断开端口。

## 步骤

### 一、生成树端口状态

1. 断开状态（Disable）：不收发BPDU
2. 监听状态（Listening）：不学习MAC，等待15s
3. 学习状态（Learning）：学习MAC，等待15s
4. 转发状态（Forwarding）：转发数据业务
5. 阻塞状态（Blocking）：阻塞端口

::: warning 注意

生成树计算最短时间为30s，最长时间为50s

:::

### 二、生成树选举使用BPDU报文

1. 桥ID（BID）：由本地交换机的优先级和MAC组成
2. 根桥ID（RID）：选举一个交换机为根桥
3. 端口ID（PID）：由交换机端口的优先级和端口编号组成
4. cost值：根据交换机接口带宽计算出的开销值

### 三、生成树开销值

| 端口速率  | 路径开销（IEEE 802.1t标准） |
| :-------: | :-------------------------: |
| 10Mbit/s  |           2000000           |
| 200Mbit/s |           200000            |
|  1Gbit/s  |            20000            |
| 10Gbit/s  |            2000             |

### 四、生成树选举基本原则

1. 根桥所有接口为指定端口（DP）

2. 每个非根桥选举，一个根端口 （RP）

3. 每段链路选举，一个指定端口（DP）

4. 没有被选举的，一个端口为阻塞端口（AP）

### 五、生成树选举过程

#### 步骤1：

选举根桥ID： BID小的优先成为根桥 ==（先选优先级小的，相同优先级，再选MAC小的）==

#### 步骤2：选举根端口

1. 端口到根桥的每段链路cost累加值小的

2. 对端BID小的，本端对应端口优先成为根端口

3. 对端PID小的，本端对应端口优先成为根端口

#### 步骤3：选举指定端口

1. 端口到根桥的每段链路cost累加值小的

2. 本端BID小的，端口优先成为指定端口

## 快速生成树协议RSTP

快速生成树RSTP由标准的STP改进而来，收敛时间属于毫秒级。

## 多实例生成树MSTP

MSTP多实例生成树是RSTP的升级，有效解决负载均衡问题。

## 华为配置

具体可以点击这里查看[实验操作](../../huawei/三、生成树实例&链路聚合.md)