import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,f as n,o as e}from"./app-BIWfNINM.js";const l="/Blog/assets/image-20240927205124404-DjMnlaMI.png",t="/Blog/assets/image-20240928095611927-BskKAEnH.png",p="/Blog/assets/image-20240928095628079-BSfQ6afT.png",d="/Blog/assets/image-20240928095641300-RzD34-GD.png",r="/Blog/assets/image-20240928095544037-YvuURo7r.png",h="/Blog/assets/image-20240928095555049-Cs0Ehu-z.png",k="/Blog/assets/image-20240928100510394-5uLCrA-b.png",c="/Blog/assets/image-20240928100520005-DwE4wQEY.png",A="/Blog/assets/image-20240928140750990-C8lg-_2d.png",g="/Blog/assets/image-20240928140804536-D_aN4zaq.png",B="/Blog/assets/image-20240928141119859-C1oJYp6b.png",v="/Blog/assets/image-20240928141135164-CLwuYCwh.png",o="/Blog/assets/image-20240928141230930-hUWDu7c9.png",m="/Blog/assets/image-20240928141243484-D5X8y2BH.png",b={};function u(y,i){return e(),a("div",null,i[0]||(i[0]=[n(`<h1 id="二十三、mpls-vpn配置" tabindex="-1"><a class="header-anchor" href="#二十三、mpls-vpn配置"><span>二十三、MPLS-VPN配置</span></a></h1><h2 id="重要配置命令" tabindex="-1"><a class="header-anchor" href="#重要配置命令"><span>重要配置命令</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] mpls lsr-id 5.5.5.5 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 R2 的 lsr-id 为 5.5.5.5</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] mpls </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用 mpls 功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] mpls ldp </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用 mpls ldp 功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-Ethernet0/0/0] mpls </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 接口下启用 mpls 功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-Ethernet0/0/0] mpls ldp </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 接口下启用 mpls ldp 功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] ip vpn-instance vpna </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 vpn 实例 vpna</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-vpn-instance-vpna] ipv4-family </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入 ipv4 地址簇</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-vpn-instance-vpna-af-ipv4] route-distinguisher 100:100 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 RD 为 100:100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-vpn-instance-vpna-af-ipv4] vpn-target 100:200 export-extcommunity </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 vpn 的 rt 导出值为 100:200</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-vpn-instance-vpna-af-ipv4] vpn-target 200:100 import-extcommunity </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 vpn 的 rt 导入值为 200:100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-Ethernet0/0/0] ip binding vpn-instance vpna </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 接口绑定实例 vpna</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] bgp 100 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 BGP 的 AS 域 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp] peer 7.7.7.7 as-number 100 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 ibgp 对等体为 7.7.7.7，AS 号为 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp] peer 7.7.7.7 connect-interface loopback 0 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 对 7.7.7.7 配置更新源接口为环回接口 LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp] ipv4-family vpnv4 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入 vpnv4 地址簇</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp-af-vpnv4] peer 7.7.7.7 enable </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 激活对等体 7.7.7.7</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp] ipv4-family vpn-instance vpna </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入 vpn 实例 vpna</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei-bgp-vpna] import-route ospf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="拓扑" tabindex="-1"><a class="header-anchor" href="#拓扑"><span>拓扑</span></a></h2><figure><img src="`+l+`" alt="image-20240927205124404" tabindex="0" loading="lazy"><figcaption>image-20240927205124404</figcaption></figure><h2 id="准备工作" tabindex="-1"><a class="header-anchor" href="#准备工作"><span>准备工作</span></a></h2><table><thead><tr><th>设备名称</th><th>接口</th><th>IP地址</th></tr></thead><tbody><tr><td>AR1</td><td>LoopBack 0</td><td>10.1.1.1/24</td></tr><tr><td></td><td>GE0/0/0</td><td>15.0.0.1/24</td></tr><tr><td>AR2</td><td>LoopBack 0</td><td>10.1.2.1/24</td></tr><tr><td></td><td>GE0/0/0</td><td>27.0.0.2/24</td></tr><tr><td>AR3</td><td>LoopBack 0</td><td>10.1.1.1/24</td></tr><tr><td></td><td>GE0/0/0</td><td>35.0.0.3/24</td></tr><tr><td>AR4</td><td>LoopBack 0</td><td>10.1.2.1/24</td></tr><tr><td></td><td>GE0/0/0</td><td>47.0.0.4/24</td></tr><tr><td>AR5</td><td>LoopBack 0</td><td>5.5.5.5/32</td></tr><tr><td></td><td>GE0/0/0</td><td>56.0.0.5/24</td></tr><tr><td></td><td>GE0/0/1</td><td>35.0.0.5/24</td></tr><tr><td></td><td>GE0/0/2</td><td>15.0.0.5/24</td></tr><tr><td>AR6</td><td>LoopBack 0</td><td>6.6.6.6/32</td></tr><tr><td></td><td>GE0/0/0</td><td>56.0.0.6/24</td></tr><tr><td></td><td>GE0/0/1</td><td>67.0.0.6/24</td></tr><tr><td>AR7</td><td>LoopBack 0</td><td>7.7.7.7/32</td></tr><tr><td></td><td>GE0/0/0</td><td>47.0.0.7/24</td></tr><tr><td></td><td>GE0/0/1</td><td>27.0.0.7/24</td></tr></tbody></table><h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤"><span>步骤</span></a></h2><ol><li>先配置底层路由</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] ospf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-ospf-1] area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-ospf-1-area-0] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/0] ospf enable area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/0] interface LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-LoopBack0] ospf enable area 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6] ospf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-ospf-1] area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-ospf-1-area-0] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/0] ospf enable area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/0] interface GigabitEthernet 0/0/1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/1] ospf enable area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/1] interface LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-LoopBack0] ospf enable area 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] ospf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-ospf-1] area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-ospf-1-area-0] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/0] ospf enable area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/0] interface LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-LoopBack0] ospf enable area 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后，使用<code>display ospf peer brief</code>检查配置是否成功</p><figure><img src="`+t+'" alt="image-20240928095611927" tabindex="0" loading="lazy"><figcaption>image-20240928095611927</figcaption></figure><figure><img src="'+p+'" alt="image-20240928095628079" tabindex="0" loading="lazy"><figcaption>image-20240928095628079</figcaption></figure><figure><img src="'+d+`" alt="image-20240928095641300" tabindex="0" loading="lazy"><figcaption>image-20240928095641300</figcaption></figure><ol start="2"><li>AR5和AR7建立IBGP邻居</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] bgp 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] router-id 5.5.5.5</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] peer 7.7.7.7 as-number 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] peer 7.7.7.7 next-hop-local</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] peer 7.7.7.7 connect-interface LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] ipv4-family vpnv4 unicast</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp-af-vpnv4] peer 7.7.7.7 enable</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] bgp 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] router-id 7.7.7.7</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] peer 5.5.5.5 as-number 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] peer 5.5.5.5 next-hop-local</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] peer 5.5.5.5 connect-interface LoopBack 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] ipv4-family vpnv4 unicast</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp-af-vpnv4] peer 5.5.5.5 enable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后，使用<code>display bgp vpnv4 all peer</code>检查配置是否成功</p><figure><img src="`+r+'" alt="image-20240928095544037" tabindex="0" loading="lazy"><figcaption>image-20240928095544037</figcaption></figure><figure><img src="'+h+`" alt="image-20240928095555049" tabindex="0" loading="lazy"><figcaption>image-20240928095555049</figcaption></figure><ol start="3"><li>配置AR5、AR6、AR7三个设备的MPLS</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] mpls lsr-id 5.5.5.5</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-mpls] mpls ldp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-mpls-ldp] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/0] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/0] mpls ldp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6] mpls lsr-id 6.6.6.6</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-mpls] mpls ldp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-mpls-ldp] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/0] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/0] mpls ldp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/0] interface GigabitEthernet 0/0/1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/1] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR6-GigabitEthernet0/0/1] mpls ldp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] mpls lsr-id 7.7.7.7</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-mpls] mpls ldp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-mpls-ldp] interface GigabitEthernet 0/0/0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/0] mpls</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/0] mpls ldp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后，使用<code>display bgp vpnv4 all peer</code>检查配置是否成功</p><figure><img src="`+k+'" alt="image-20240928100510394" tabindex="0" loading="lazy"><figcaption>image-20240928100510394</figcaption></figure><figure><img src="'+c+`" alt="image-20240928100520005" tabindex="0" loading="lazy"><figcaption>image-20240928100520005</figcaption></figure><ol start="4"><li>实例配置</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] ip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1] route-distinguisher 100:100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1-af-ipv4] vpn-target 100:200 export-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1-af-ipv4] vpn-target 200:100 import-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] ip vpn-instace 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1] route-distinguisher 200:200</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1-af-ipv4] vpn-target 300:400 export-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-vpn-instance-1-af-ipv4] vpn-target 400:300 import-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] interface GigabitEthernet0/0/2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/2] ip binding vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/2] ip address 15.0.0.5 24</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/2] interface GigabitEthernet0/0/1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-GigabitEthernet0/0/1] ip address 35.0.0.5 24</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] ip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1] route-distinguisher 100:100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1-af-ipv4] vpn-target 200:100 export-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1-af-ipv4] vpn-target 100:200 import-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] ip vpn-instace 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1] route-distinguisher 200:200</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1-af-ipv4] vpn-target 400:300 export-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-vpn-instance-1-af-ipv4] vpn-target 300:400 import-extcommunity</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] interface GigabitEthernet0/0/2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/2] ip binding vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/2] ip address 27.0.0.7 24</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/2] interface GigabitEthernet0/0/1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-GigabitEthernet0/0/1] ip address 47.0.0.7 24</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>AR1和AR5、AR7和AR2配置RIP协议，AR3和AR5、AR7和AR4配置OSPF协议。</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置RIP</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR1] rip</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR1-rip-1] version 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR1-rip-1] network 10.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR1-rip-1] network 15.0.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR2] rip</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR2-rip-1] version 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR2-rip-1] network 10.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR2-rip-1] network 27.0.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] rip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-rip-1] version 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-rip-1] network 27.0.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] rip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-rip-1] version 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-rip-1] network 27.0.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置OSPF</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR3] ospf 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR3-ospf-100] area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR3-ospf-100-area-0.0.0.0]network 10.1.1.0 0.0.0.255</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR3-ospf-100-area-0.0.0.0]network 35.0.0.0 0.0.0.255</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR4] ospf 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR4-ospf-100] area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR4-ospf-100-area-0.0.0.0]network 10.1.1.0 0.0.0.255</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR4-ospf-100-area-0.0.0.0]network 47.0.0.0 0.0.0.255</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5]ospf 100 vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-ospf-100]area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-ospf-100-area-0.0.0.0]net 35.0.0.0 0.0.0.255</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7]ospf 100 vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-ospf-100]area 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-ospf-100-area-0.0.0.0]net 47.0.0.0 0.0.0.255</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>把RIP、OSPF引入到BGP里面</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] bgp 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp] ipv4-family vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp-1] import-route rip 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp-1] ipv4-family vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-bgp-2] import-route ospf 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] rip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-rip-1] import-route bgp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5] ospf 100 vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR5-ospf-100] import-route bgp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] bgp 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp] ipv4-family vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp-1] import-route rip 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp-1] ipv4-family vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-bgp-2] import-route ospf 100</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] rip vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-rip-1] import-route bgp</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7] ospf 100 vpn-instance 2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[AR7-ospf-100] import-route bgp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后，检查配置是否成功</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] display ip routing-table vpn-instance 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Huawei] display ip routing-table vpn-instance 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+A+'" alt="image-20240928140750990" tabindex="0" loading="lazy"><figcaption>image-20240928140750990</figcaption></figure><figure><img src="'+g+'" alt="image-20240928140804536" tabindex="0" loading="lazy"><figcaption>image-20240928140804536</figcaption></figure><p>同时查看AR1、AR2、AR3、AR4的路由表，查看是否有学习到路由。</p><figure><img src="'+B+'" alt="image-20240928141119859" tabindex="0" loading="lazy"><figcaption>image-20240928141119859</figcaption></figure><figure><img src="'+v+'" alt="image-20240928141135164" tabindex="0" loading="lazy"><figcaption>image-20240928141135164</figcaption></figure><figure><img src="'+o+'" alt="image-20240928141230930" tabindex="0" loading="lazy"><figcaption>image-20240928141230930</figcaption></figure><figure><img src="'+m+'" alt="image-20240928141243484" tabindex="0" loading="lazy"><figcaption>image-20240928141243484</figcaption></figure><ol start="7"><li>用AR1、AR3去ping<code>10.1.2.1</code>，分别在AR2、AR4抓包，观察ICMP报文是否有去到相对应的路径。</li></ol>',40)]))}const R=s(b,[["render",u],["__file","二十三、MPLS-VPN配置.html.vue"]]),E=JSON.parse('{"path":"/notes/web/huawei/%E4%BA%8C%E5%8D%81%E4%B8%89%E3%80%81MPLS-VPN%E9%85%8D%E7%BD%AE.html","title":"二十三、MPLS-VPN配置","lang":"zh-CN","frontmatter":{"title":"二十三、MPLS-VPN配置","order":23,"description":"二十三、MPLS-VPN配置 重要配置命令 拓扑 image-20240927205124404image-20240927205124404 准备工作 步骤 先配置底层路由 配置完成后，使用display ospf peer brief检查配置是否成功 image-20240928095611927image-20240928095611927 im...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/Blog/notes/web/huawei/%E4%BA%8C%E5%8D%81%E4%B8%89%E3%80%81MPLS-VPN%E9%85%8D%E7%BD%AE.html"}],["meta",{"property":"og:site_name","content":"A.M. Blog"}],["meta",{"property":"og:title","content":"二十三、MPLS-VPN配置"}],["meta",{"property":"og:description","content":"二十三、MPLS-VPN配置 重要配置命令 拓扑 image-20240927205124404image-20240927205124404 准备工作 步骤 先配置底层路由 配置完成后，使用display ospf peer brief检查配置是否成功 image-20240928095611927image-20240928095611927 im..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-04T15:17:10.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-04T15:17:10.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"二十三、MPLS-VPN配置\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-04T15:17:10.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Arrow Magician\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"重要配置命令","slug":"重要配置命令","link":"#重要配置命令","children":[]},{"level":2,"title":"拓扑","slug":"拓扑","link":"#拓扑","children":[]},{"level":2,"title":"准备工作","slug":"准备工作","link":"#准备工作","children":[]},{"level":2,"title":"步骤","slug":"步骤","link":"#步骤","children":[]}],"git":{"createdTime":1728055030000,"updatedTime":1728055030000,"contributors":[{"name":"Arrow-Magician","email":"315903697@qq.com","commits":1}]},"readingTime":{"minutes":4.51,"words":1352},"filePathRelative":"notes/web/huawei/二十三、MPLS-VPN配置.md","localizedDate":"2024年10月4日","autoDesc":true}');export{R as comp,E as data};
